<h1>Projeto 02 - Blog Pessoal - Classe PostagemController e PostagemService - M√©todo Consultar Postagens por Id</h1>

O que veremos por aqui:

1. Criar o M√©todo GetById(long id) na Classe PostagemService
2. Criar o M√©todo GetById(long id) na Classe PostagemController
3. Testar o M√©todo no Insomnia

<h2>1. O Recurso Postagem</h2>

Na etapa anterior, come√ßamos a construir as Classes **PostagemService** e  **PostagemController**, al√©m de  implementamos o M√©todo **GetAll()**, que retorna todos os Objetos da Classe Postagem persistidos no Banco de dados. Vamos continuar a constru√ß√£o das nossas Classes implementando o **M√©todo GetById( long id )**.

```mermaid
classDiagram
class Postagem {
  + Id : Long
  + Titulo : String
  + Texto: String
  + GetAll()
  + GetById(long id)
  + GetByTitulo(string titulo)
  + Create(Postagem postagem)
  + Update(Postagem postagem)
  + Delete(long id)
}
class Auditable {
  + Data: DateTimeOffset
}
Postagem --|> Auditable: Herda
```

<br />

<h2>üë£ Passo 01 - Implementar o M√©todo GetById(long id) na Classe PostagemService</h2>



Vamos implementar o M√©todo **GetById(long id)** na Classe PostagemService. Tra√ßando um paralelo com o MySQL, seria o equivalente a instru√ß√£o: <code>SELECT * FROM tb_postagens where id = id;</code>.

1. Abra a Classe **PostagemService**.

2. Insira o c√≥digo abaixo no M√©todo **GetById(long id)**.

<div align="left"><img src="https://i.imgur.com/7b9bCqU.png" title="source: imgur.com" /></div>

Vamos analisar o c√≥digo do M√©todo:

**Linhas 22 a 35:** Criamos o M√©todo Ass√≠ncrono (async), chamado **GetById(long id)**, que promete retornar uma **Promise** com **apenas um** Objeto da Classe Postagem. Como o M√©todo **GetById(long id)** lista apenas um Objeto espec√≠fico, diferente do M√©todo GetAll() que lista todos, ser√° necess√°rio criar apenas um Objeto da Classe Postagem para armazenar o Objeto procurado.

Note que a Classe **Task** recebe no par√¢metro Generic Type (<T>) o tipo Postagem, entretanto, ao lado do tipo foi adicionado uma interroga√ß√£o (**?**). Esta interroga√ß√£o indica que o Objeto Postagem, que ser√° retornado pelo M√©todo, pode ser nulo (null), caso ele n√£o seja encontrado na consulta ao Banco de dados.

Observe que o M√©todo **GetById(long id)** possui um par√¢metro do tipo **long**, chamado **id**. Esta vari√°vel receber√° o id da Postagem que voc√™ deseja procurar. O id ser√° enviado pelo M√©todo da **Classe PostagemController**. 

**Linhas 24 a 33:** Criamos uma estrutura de tratamento de erros **try...catch**, para checar se a Postagem foi ou n√£o encontrada.

**Linha 26:** Criamos um Objeto da Classe postagem, chamado **Postagem**, que receber√° o resultado da execu√ß√£o do M√©todo **FirstAsync(i => i.Id == id)**, da Interface **PostagemService**, que retorna apenas um Objeto espec√≠fico (o primeiro), cujo id seja igual ao valor da vari√°vel id (par√¢metro do M√©todo GetById(long id)). Tra√ßando um paralelo com o SQL, o M√©todo **FirstAsync(i => i.Id == id)** seria o equivalente a instru√ß√£o: <code>SELECT * FROM tb_postagens where id = id_procurado;</code>. 

Observe que na instru√ß√£o **return** foi inserido o comando **await** (aguarde), que na pr√°tica significa espere que a **Promise** seja resolvida (o Objeto Postagem seja encontrado e inserido no Objeto Postagem criado na Promise na linha 26), antes de retornar a execu√ß√£o do M√©todo e o valor resolvido para a Classe que acionou o M√©todo.

Note que o crit√©rio de busca, foi definido no par√¢metro do M√©todo **FirstAsync(i => i.Id == id)**, atrav√©s de uma **Express√£o Lambda**. 

<br />

| <img src="https://i.imgur.com/RfjtOFi.png" title="source: imgur.com" width="100px"/> | <div align="left">**DICA:** *Caso tenha alguma d√∫vida sobre Express√µes Lambda, <a href="https://github.com/rafaelq80/cookbook_csharp/blob/main/01_csharp/18.md">clique aqui</a> e explore como criar e utilizar Express√µes Lambda.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

**Linha 28:** Se o Objeto postagem for encontrado, o M√©todo retorna o Objeto postagem para a Classe que acionou o M√©todo, atrav√©s da palavra reservada **return**.

**Linha 32:** Se a Postagem n√£o foi encontrada, caso o usu√°rio digite um id que n√£o exista, por exemplo, o Objeto Postagem ser√° nulo e o M√©todo retorna um Objeto **null** para a Classe que acionou o M√©todo, atrav√©s da palavra reservada **return**.

<br />

<div align="left"><img src="https://i.imgur.com/wHTDfQ2.png" title="source: imgur.com" width="4%"/> <a href="https://learn.microsoft.com/pt-br/dotnet/api/system.threading.tasks.task-1?view=net-7.0" target="_blank"><b>Documenta√ß√£o: Task</b></a></div>

<div align="left"><img src="https://i.imgur.com/wHTDfQ2.png" title="source: imgur.com" width="4%"/> <a href="https://learn.microsoft.com/pt-br/dotnet/csharp/asynchronous-programming/async-scenarios" target="_blank"><b>Documenta√ß√£o: Programa√ß√£o Ass√≠ncrona</b></a></div>

<div align="left"><img src="https://i.imgur.com/wHTDfQ2.png" title="source: imgur.com" width="4%"/> <a href="https://learn.microsoft.com/pt-br/dotnet/csharp/asynchronous-programming/task-asynchronous-programming-model" target="_blank"><b>Documenta√ß√£o: Modelo de Tarefa Ass√≠ncrona</b></a></div>

<div align="left"><img src="https://i.imgur.com/wHTDfQ2.png" title="source: imgur.com" width="4%"/> <a href="https://learn.microsoft.com/pt-br/dotnet/csharp/fundamentals/types/generics" target="_blank"><b>Documenta√ß√£o: Classes Gen√©ricas</b></a></div>

<br />

<h2>üë£ Passo 02 - Criar o M√©todo GetById(long id) na Classe PostagemController</h2>



Vamos implementar o M√©todo **GetById(long id)** na Classe PostagemController, que tem como objetivo executar o M√©todo com o mesmo nome na Classe de Servi√ßo PostagemService. 

1. Abra a Classe **PostagemController**.

2. Insira o c√≥digo abaixo depois do M√©todo **GetAll()**.

<div align="left"><img src="https://i.imgur.com/xwrrKS8.png" title="source: imgur.com" /></div>

Vamos analisar o c√≥digo do M√©todo:

**Linhas 30 a 41:** Criamos o M√©todo **GetById(long id)** como um **M√©todo Ass√≠ncrono**, atrav√©s da palavra reservada **async**, que promete retornar um Objeto **ActionResult**, contendo um Objeto da Classe Postagem, recebido do **M√©todo GetById(long id) da Classe de Servi√ßo PostagemService**. 

**Linha 30:** A Anota√ß√£o **[HttpGet("{id}")]** mapeia todas as Requisi√ß√µes **HTTP GET**, enviadas para um endere√ßo espec√≠fico, chamado **endpoint**, dentro do Recurso Postagem, para um M√©todo espec√≠fico que responder√° a Requisi√ß√£o. No Projeto Blog Pessoal, ele indica que o M√©todo **GetById(long id)**, responder√° a todas as requisi√ß√µes do tipo **HTTP GET**, enviadas para o endere√ßo **http://localhost:5000/postagens/{id}**. O **{id}** √© uma vari√°vel de caminho, que ser√° substitu√≠da pelo id da postagem, que se deseja consultar. O Valor enviado na vari√°vel de caminho, ser√° inserido no par√¢metro **id** do m√©todo **GetById( long id )**.

**Exemplo:**

http://localhost:5000/postagens/1

Neste exemplo, o par√¢metro **long id**, do M√©todo  **GetById( long id )**, receber√° o valor 1 (Id que ser√° procurado na tabela tb_postagens), que foi enviado na vari√°vel de caminho **/{id}**.

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="150px"/> | <div align="left"> **ATEN√á√ÉO:** *O Endere√ßo deste Endpoint ser√° composto pelo Endere√ßo do Recurso (/postagens) + a vari√°vel de caminho ({id}), indicada na anota√ß√£o [HttpGet("{id}")]. Lembre-se que n√£o pode existir dois ou mais m√©todos do tipo GET com o mesmo endere√ßo.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="80px"/> | <div align="left"> **ATEN√á√ÉO:** *Por quest√µes de boas pr√°ticas e legibilidade do c√≥digo, a Vari√°vel de Caminho e o Par√¢metro do M√©todo devem possuir o mesmo nome e escrita (letras min√∫sculas).* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

**Linha 33:** Criamos um Objeto da Classe postagem, chamado **Resposta**, que receber√° o resultado da execu√ß√£o do M√©todo **GetById(id)**, da Classe **PostagemService**, que retorna apenas um Objeto espec√≠fico (o primeiro), cujo id seja igual ao valor da vari√°vel id (par√¢metro do M√©todo GetById(long id)). 

**Linhas 35 a 38:** Verifica se o Objeto **Resposta** √© nulo (null). Caso seja nulo, o M√©todo **GetById( long id )** retornar√° o HTTP Status **NOT FOUND ü°™ 404** (N√£o Encontrado!), atrav√©s do M√©todo **NotFound()**.

**Linha 40:** Caso a Postagem seja encontrada, retornaremos o Objeto Resposta atrav√©s do M√©todo **Ok()**. O M√©todo **Ok()** cria uma  **Resposta HTTP** padr√£o, com o HTTP Status **OK ü°™ 200**, e insere no Corpo da Resposta um JSON, contendo o Objeto Postagem encontrado. 

Observe que o M√©todo foi chamado atrav√©s da **Inje√ß√£o de Depend√™ncia _postagemService** e foi adicionada a palavra reservada **await**, por se tratar de um M√©todo Ass√≠ncrono.

Caso seja passada uma string, ao inv√©s de um numero na vari√°vel de caminho **id**, ser√° retornado o HTTP Status **BadRequest ü°™ 400**, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/iRVtJnj.png" title="source: imgur.com" /></div>

<br />

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Methods" target="_blank"><b>Documenta√ß√£o: HTTP Methods Request</b></a></div>

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Status" target="_blank"><b>Documenta√ß√£o: HTTP Status Code</b></a></div>

<div align="left"><img src="https://i.imgur.com/wHTDfQ2.png" title="source: imgur.com" width="4%"/> <a href="https://learn.microsoft.com/pt-br/dotnet/api/microsoft.aspnetcore.mvc.controllerbase?view=aspnetcore-7.0" target="_blank"><b>Documenta√ß√£o: Classe ControllerBase</b></a></div>

<div align="left"><img src="https://i.imgur.com/wHTDfQ2.png" title="source: imgur.com" width="4%"/> <a href="https://learn.microsoft.com/pt-br/aspnet/core/web-api/?view=aspnetcore-7.0" target="_blank"><b>Documenta√ß√£o: Criar APIs Web com o ASP.NET Core</b></a></div>

<div align="left"><img src="https://i.imgur.com/wHTDfQ2.png" title="source: imgur.com" width="4%"/> <a href="https://learn.microsoft.com/pt-br/aspnet/core/mvc/controllers/dependency-injection?view=aspnetcore-7.0" target="_blank"><b>Documenta√ß√£o: Inje√ß√£o de depend√™ncia em controladores</b></a></div>

<div align="left"><img src="https://i.imgur.com/wHTDfQ2.png" title="source: imgur.com" width="4%"/> <a href="https://learn.microsoft.com/pt-br/dotnet/api/microsoft.aspnetcore.mvc.actionresult?view=aspnetcore-7.0" target="_blank"><b>Documenta√ß√£o: Classe ActionResult</b></a></div>

<div align="left"><img src="https://i.imgur.com/wHTDfQ2.png" title="source: imgur.com" width="4%"/> <a href="https://learn.microsoft.com/pt-br/dotnet/api/microsoft.aspnetcore.mvc.controllerbase.ok?view=aspnetcore-7.0" target="_blank"><b>Documenta√ß√£o: M√©todo Ok()</b></a></div>

<div align="left"><img src="https://i.imgur.com/wHTDfQ2.png" title="source: imgur.com" width="4%"/> <a href="https://learn.microsoft.com/pt-br/dotnet/api/microsoft.aspnetcore.mvc.controllerbase.notfound?view=aspnetcore-7.0" target="_blank"><b>Documenta√ß√£o: M√©todo NotFound()</b></a></div>

<br />


<h2>üë£ Passo 03 - Executar o projeto</h2>



Para executarmos o Projeto, clique no bot√£o <img src="https://i.imgur.com/gPnfOVk.png" title="source: imgur.com" width="8%"/>**Run http**, na **Barra de Ferramentas Principal** (indicado em verde na imagem):

![Imagem 30](https://i.imgur.com/Ya4O50P.png)

<br />

<h2>üë£ Passo 04 - Testar no Insomnia</h2>



Agora vamos criar a Requisi√ß√£o para o M√©todo **GetById( long id )**:

1. Clique com o bot√£o direito do mouse sobre a **Pasta Postagem** para abrir o menu e clique na op√ß√£o **New Request**.

<div align="center"><img src="https://i.imgur.com/bFUVP3h.png" title="source: imgur.com" /></div>

2. Ser√° criada uma nova Requisi√ß√£o (New Request) dentro da pasta **Postagem**.

   <div align="center"><img src="https://i.imgur.com/CA70WQn.png" title="source: imgur.com" /></div>

3. D√™ um duplo clique sobre a nova requisi√ß√£o (**New Request**), informe o nome da requisi√ß√£o (indicado na imagem abaixo na cor amarela) e pressione a tecla **enter** do seu teclado.

<div align="center"><img src="https://i.imgur.com/reMehb6.png" title="source: imgur.com" /></div>

4. Selecione o M√©todo HTTP que ser√° utilizado (**GET**) na requisi√ß√£o, indicado na imagem abaixo na cor verde. 

<div align="center"><img src="https://i.imgur.com/mWPpKHD.png" title="source: imgur.com" /></div>

5. Configure a requisi√ß√£o conforme a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/KpAKlSu.png" title="source: imgur.com" /></div>

6. No item marcado em amarelo na imagem acima, informe o endere√ßo (endpoint) da Requisi√ß√£o. A requisi√ß√£o **Consultar postagem por ID** foi configurada da seguinte maneira:

- A primeira parte do endere√ßo (http://localhost:5000) √© o endere√ßo do nosso servidor local. Quando a aplica√ß√£o estiver na nuvem, ele ser√° substitu√≠do pelo endere√ßo da nuvem (Exemplo: http://nomedaaplicacao.onrender.com).
- A segunda parte do endere√ßo √© o **endpoint** configurado na anota√ß√£o ***[Route("~/postagens")]***, em nosso caso **/postagens**.  
- A terceira parte (**/1**) √© a vari√°vel de caminho **id**. Informe o id da postagem que voc√™ deseja procurar.

7. Para testar a requisi√ß√£o, com a aplica√ß√£o rodando, clique no bot√£o <img src="https://i.imgur.com/sy0V8Nx.png" title="source: imgur.com" width="60px"/>.

8. O resultado da requisi√ß√£o voc√™ confere na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/jtnqiJS.png" title="source: imgur.com" /></div>

9. Observe que a aplica√ß√£o quando encontra o Objeto no Banco de dados, al√©m de exibir os dados do Objeto no Corpo da Resposta, respeitando o crit√©rio informado na consulta (id = 1), ela tamb√©m retorna um **HTTP Status 200 ü°™ OK** (indicado em verde na imagem acima), informando que a Requisi√ß√£o foi bem sucedida!

10. Caso o Objeto Postagem n√£o seja encontrado, a aplica√ß√£o retornar√° o **HTTP Status 404 ü°™ NOT FOUND** (N√£o encontrado), marcado em laranja na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/5lCAhBv.png" title="source: imgur.com" /></div>

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="5%"/> <a href="" target="_blank"><b>C√≥digo fonte do projeto</b></a></div>

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>