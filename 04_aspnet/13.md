<h1>Projeto 02 - Blog Pessoal - Classe PostagemController e PostagemService - M√©todo Deletar</h1>



O que veremos por aqui:

1. Implementar o m√©todo Delete(Postagem postagem) na Classe PostagemService
2. Criar o m√©todo Delete(Postagem postagem) na Classe PostagemController
3. Testar o M√©todo no Insomnia

<br />

<h2>1. O Recurso Postagem</h2>

Nas etapas anteriores, constru√≠mos as Classes **PostagemService** e **PostagemController** e implementamos os M√©todos:

- **GetAll()**  ü°™ Retorna todos os Objetos da Classe Postagem persistidos no Banco de dados.

- **GetById(long id)** ü°™ Retorna um Objeto espec√≠fico da Classe Postagem persistidos no Banco de dados. A Postagem √© identificada pelo atributo id. 

- **GetByTitulo(string titulo)** ü°™ Retorna  todos os Objetos da Classe Postagem persistidos no Banco de  dados, cujo atributo titulo contenha (em qualquer parte) a string enviada no par√¢metro titulo do M√©todo.

- **M√©todo Create(Postagem postagem)** ü°™ Persiste (salva) um novo Objeto da Classe Postagem no Banco de dados.

- **M√©todo Update(Postagem postagem)** ü°™ Atualiza um Objeto da Classe Postagem persistido no Banco de dados.

Vamos finalizar a constru√ß√£o das Classes **PostagemService** e  **PostagemController** implementando os M√©todos **Delete(Postagem postagem)** e **Delete(long id)** respectivamente, que apagar√° um Objeto da Classe Postagem persistido no Banco de dados, identificado pelo seu id.

```mermaid
classDiagram
class Postagem {
  + Id : Long
  + Titulo : String
  + Texto: String
  + GetAll()
  + GetById(long id)
  + GetByTitulo(string titulo)
  + Create(Postagem postagem)
  + Update(Postagem postagem)
  + Delete(long id)
}
class Auditable {
  + Data: DateTimeOffset
}
Postagem --|> Auditable: Herda
```

<br />

<h2>üë£ Passo 01 - Criar o M√©todo Delete(Postagem postagem) na Classe PostagemService</h2>



Vamos implementar o M√©todo **Delete(Postagem postagem)** na Classe **PostagemService**, que retornar√° a confirma√ß√£o da exclus√£o de um Objeto espec√≠fico persistido no Banco de dados. 

1. Abra a Classe **PostagemService**.

2. Insira o c√≥digo abaixo no M√©todo **GetById(long id)**.

<div align="left"><img src="https://i.imgur.com/Vn6Be7u.png" title="source: imgur.com" /></div>

Vamos analisar o c√≥digo do M√©todo:

**Linhas 72 a 78:** Criamos o M√©todo Ass√≠ncrono (async), chamado **Delete(Postagem postagem)**, que promete retornar uma **Promise** com a confirma√ß√£o de que **um** Objeto da Classe Postagem foi exclu√≠do. 

Observe que o M√©todo **Delete(Postagem postagem)** possui um par√¢metro do tipo **Postagem**, chamado **postagem**. Esta vari√°vel receber√° um Objeto da Classe Postagem, que foi enviado pelo M√©todo da **Classe PostagemController**.

**Linha 75:** Adicionamos o Objeto postagem na lista de Objetos rastreados pelo **DbContext**, para a exclus√£o, atrav√©s do M√©todo **Remove**, at√© que ele seja exclu√≠do no Banco de dados.

**Linha 76:** O Objeto postagem √© exclu√≠do no Banco de dados e a exclus√£o √© confirmada atrav√©s do M√©todo **SaveChangesAsync**.

Observe que na instru√ß√£o **SaveChangesAsync** foi inserido o comando **await** (aguarde), que na pr√°tica significa espere que a **Promise** seja resolvida (o Objeto postagem exclu√≠do). 

O M√©todo **SaveChangesAsync** funciona como uma esp√©cie de "finalizador" das opera√ß√µes que criam, modificam ou excluem Objetos persistidos no Banco de dados. 

<br />

<h2>üë£ Passo 02 - Criar o M√©todo Delete(long id) na Classe PostagemController</h2>



Vamos implementar o M√©todo **Delete(long id) **na Classe **PostagemController**, com o objetivo de executar o M√©todo com o mesmo nome na Classe de Servi√ßo PostagemService. Tra√ßando um paralelo com o SQL, seria o equivalente a instru√ß√£o: <code>DELETE FROM tb_postagens WHERE id = id;</code>. 

1. Abra a Classe **PostagemController**.

2. Insira o c√≥digo abaixo depois do M√©todo **Update(Postagem postagem)**.

<div align="left"><img src="https://i.imgur.com/i0RGBzh.png" title="source: imgur.com" /></div>

Vamos analisar o c√≥digo do M√©todo:

**Linhas 82 a 94:** Criamos o M√©todo **Delete(long id)** como um **M√©todo Ass√≠ncrono**, atrav√©s da palavra reservada **async**, que promete retornar um Objeto **ActionResult**, contendo a confirma√ß√£o de que um Objeto da Classe Postagem foi exclu√≠do, pelo **M√©todo Delete(Postagem postagem) da Classe de Servi√ßo PostagemService**. 

**Linha 82:** A Anota√ß√£o **[HttpDelete("{id}")]** mapeia todas as Requisi√ß√µes **HTTP DELETE**, enviadas para um endere√ßo espec√≠fico, chamado **endpoint**, dentro do Recurso Postagem, para um M√©todo espec√≠fico que responder√° a Requisi√ß√£o. No Projeto Blog Pessoal, ele indica que o M√©todo **Delete(long id)**, responder√° a todas as requisi√ß√µes do tipo **HTTP DELETE**, enviadas para o endere√ßo **http://localhost:5000/postagens/{id}**. O **{id}** √© uma vari√°vel de caminho, que ser√° substitu√≠da pelo id da postagem, que se deseja excluir. O Valor enviado na vari√°vel de caminho, ser√° inserido no par√¢metro **id** do m√©todo **Delete( long id )**.

**Exemplo:**

http://localhost:5000/postagens/3

Neste exemplo, o par√¢metro **long id**, do M√©todo  **Delete( long id )**, receber√° o valor 3 (Id da postagem que ser√° exclu√≠do na tabela tb_postagens), que foi enviado na vari√°vel de caminho **/{id}**.

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="150px"/> | <div align="left"> **ATEN√á√ÉO:** *O Endere√ßo deste Endpoint ser√° composto pelo Endere√ßo do Recurso (/postagens) + a vari√°vel de caminho ({id}), indicada na anota√ß√£o [HttpGet("{id}")]. Embora este seja o mesmo endere√ßo do endpoint associado ao M√©todo GetById( long id ), os Verbos HTTP dos 2 endpoints s√£o diferentes.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="80px"/> | <div align="left"> **ATEN√á√ÉO:** *Por quest√µes de boas pr√°ticas e legibilidade do c√≥digo, a Vari√°vel de Caminho e o Par√¢metro do M√©todo devem possuir o mesmo nome e escrita (letras min√∫sculas).* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

**Linha 85:** Criamos um Objeto da Classe postagem, chamado **BuscaPostagem**, que receber√° o resultado da execu√ß√£o do M√©todo **GetById(id)**, da Interface **PostagemService**, que retorna apenas um Objeto espec√≠fico, cujo id seja igual ao valor da vari√°vel de caminho **id**. 

Observe que na istru√ß√£o acima foi inserido o comando **await** (aguarde), que na pr√°tica significa espere que a **Promise** seja resolvida (o Objeto Postagem seja encontrado), antes de retornar a execu√ß√£o do M√©todo e o valor resolvido.

**Linhas 87 a 88:** Verifica se o Objeto **BuscaPostagem** √© nulo. Caso seja nulo, o M√©todo **Delete(long id)** retornar√° o HTTP Status **NOT FOUND ü°™ 404** (N√£o Encontrado!), atrav√©s do M√©todo **NotFound()**.

**Linha 90:** Se o Objeto postagem for encontrado, executamos o M√©todo **Delete(BuscaPostagem)**, da Classe  **PostagemService**, respons√°vel por excluir o Objeto no Banco de dados.

Observe que na instru√ß√£o **Delete(Postagem postagem)** foi inserido o comando **await** (aguarde), que na pr√°tica significa espere que a **Promise** seja resolvida (o Objeto postagem seja exclu√≠do).

**Linha 59:** Retorna a  **Resposta HTTP** No Content, com o HTTP Status **NOCONTENT ü°™ 204**, atrav√©s do M√©todo **NoContent()**, indicando que o Objeto n√£o existe mais.

<br />

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Methods" target="_blank"><b>Documenta√ß√£o: HTTP Methods Request</b></a></div>

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Status" target="_blank"><b>Documenta√ß√£o: HTTP Status Code</b></a></div>

<div align="left"><img src="https://i.imgur.com/wHTDfQ2.png" title="source: imgur.com" width="4%"/> <a href="https://learn.microsoft.com/pt-br/dotnet/api/microsoft.aspnetcore.mvc.controllerbase?view=aspnetcore-7.0" target="_blank"><b>Documenta√ß√£o: Classe ControllerBase</b></a></div>

<div align="left"><img src="https://i.imgur.com/wHTDfQ2.png" title="source: imgur.com" width="4%"/> <a href="https://learn.microsoft.com/pt-br/aspnet/core/web-api/?view=aspnetcore-7.0" target="_blank"><b>Documenta√ß√£o: Criar APIs Web com o ASP.NET Core</b></a></div>

<div align="left"><img src="https://i.imgur.com/wHTDfQ2.png" title="source: imgur.com" width="4%"/> <a href="https://learn.microsoft.com/pt-br/aspnet/core/mvc/controllers/dependency-injection?view=aspnetcore-7.0" target="_blank"><b>Documenta√ß√£o: Inje√ß√£o de depend√™ncia em controladores</b></a></div>

<div align="left"><img src="https://i.imgur.com/wHTDfQ2.png" title="source: imgur.com" width="4%"/> <a href="https://learn.microsoft.com/pt-br/dotnet/api/microsoft.aspnetcore.mvc.actionresult?view=aspnetcore-7.0" target="_blank"><b>Documenta√ß√£o: Classe ActionResult</b></a></div>

<div align="left"><img src="https://i.imgur.com/wHTDfQ2.png" title="source: imgur.com" width="4%"/> <a href="https://learn.microsoft.com/pt-br/dotnet/api/microsoft.aspnetcore.mvc.controllerbase.nocontent?view=aspnetcore-7.0" target="_blank"><b>Documenta√ß√£o: M√©todo NoContent()</b></a></div>

<div align="left"><img src="https://i.imgur.com/wHTDfQ2.png" title="source: imgur.com" width="4%"/> <a href="https://learn.microsoft.com/pt-br/dotnet/api/microsoft.aspnetcore.mvc.controllerbase.notfound?view=aspnetcore-7.0" target="_blank"><b>Documenta√ß√£o: M√©todo NotFound()</b></a></div>

<br />



Para executarmos o Projeto, clique no bot√£o <img src="https://i.imgur.com/gPnfOVk.png" title="source: imgur.com" width="8%"/>**Run http**, na **Barra de Ferramentas Principal** (indicado em verde na imagem):

![Imagem 30](https://i.imgur.com/Ya4O50P.png)

<br />

<h2>üë£ Passo 04 - Testar no Insomnia</h2>



Agora vamos criar a Requisi√ß√£o para o M√©todo **Delete(long id)**:

1. Clique com o bot√£o direito do mouse sobre a **Pasta Postagem** para abrir o menu e clique na op√ß√£o **New HTTP Request**.

<div align="center"><img src="https://i.imgur.com/KvRI8b2.png" title="source: imgur.com" /></div>

2. Ser√° criada uma nova Requisi√ß√£o (New Request) dentro da pasta **Postagem**.

   <div align="center"><img src="https://i.imgur.com/CA70WQn.png" title="source: imgur.com" /></div>

3. D√™ um duplo clique sobre a nova requisi√ß√£o (**New Request**), informe o nome da requisi√ß√£o (indicado na imagem abaixo na cor amarela) e pressione a tecla **enter** do seu teclado.

<div align="center"><img src="https://i.imgur.com/rZ0KTLu.png" title="source: imgur.com" /></div>

4. Selecione o M√©todo HTTP que ser√° utilizado (**DELETE**) na requisi√ß√£o, indicado na imagem abaixo na cor verde. 

<div align="center"><img src="https://i.imgur.com/qvMhoEx.png" title="source: imgur.com" /></div>

5. Configure a requisi√ß√£o conforme a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/Tb4fh2t.png" title="source: imgur.com" /></div>

6. No item marcado em amarelo na imagem acima, informe o endere√ßo (endpoint) da Requisi√ß√£o. A requisi√ß√£o **Deletar Postagem** foi configurada da seguinte maneira:

   - A primeira parte do endere√ßo (http://localhost:5000) √© o endere√ßo do nosso servidor local. Quando a aplica√ß√£o estiver na nuvem, ele ser√° substitu√≠do pelo endere√ßo da nuvem (Exemplo: http://nomedaaplicacao.onrender.com).
   - A segunda parte do endere√ßo √© o **endpoint** configurado na anota√ß√£o ***[Route("~/postagens")]***, em nosso caso **/postagens**.  
   - A terceira parte (**/3**) √© a vari√°vel de caminho **id**. Informe o id da postagem que voc√™ deseja excluir.
   
7. Para testar a requisi√ß√£o, com a aplica√ß√£o rodando, clique no bot√£o <img src="https://i.imgur.com/sy0V8Nx.png" title="source: imgur.com" width="60px"/>.

8. O resultado da requisi√ß√£o voc√™ confere na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/MTjui2P.png" title="source: imgur.com" /></div>

9. Observe que a aplica√ß√£o retorna apenas um **HTTP Status 204 ü°™ NO_CONTENT** (indicado em verde na imagem acima). Este Status indica que a Requisi√ß√£o foi bem sucedida!, o Objeto foi apagado e o seu conte√∫do n√£o existe mais.

10. Caso o Objeto n√£o seja encontrado, a aplica√ß√£o retornar√° o **HTTP Status 404 ü°™ NOT FOUND** (N√£o encontrado), como mostra a figura abaixo (marcado em laranja).

<div align="center"><img src="https://i.imgur.com/fqPcQy7.png" title="source: imgur.com" /></div>

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="5%"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_aspnet_v7/tree/10_postagem_controller_delete" target="_blank"><b>C√≥digo fonte do projeto</b></a></div>

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>