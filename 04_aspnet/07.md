
<h1>Projeto 02 - Blog Pessoal - Interface Postagem Service</h1>



O que veremos por aqui:

1. Criar a Interface IPostagemService
1. Implementar os M√©todos na Classe PostagemService
1. Registrar a Classe PostagemService na Classe Program



<h2>1. O Recurso Postagem</h2>



Na etapa anterior, come√ßamos a construir o Recurso Postagem, a partir da Classe Model Postagem, onde implementamos todos os Atributos do recurso. Veja o Diagrama de Classes abaixo: 

```mermaid
classDiagram
class Postagem {
  - Id : Long
  - Titulo : String
  - Texto: String
  + GetAll()
  + GetById(long id)
  + GetByTitulo(string titulo)
  + Post(Postagem postagem)
  + Put(Postagem postagem)
  + Delete(long id)
}
class Auditable {
  - Data: DateTimeOffset
}
Postagem --|> Auditable: Herda
```

Nesta etapa, vamos construir a **Interface PostagemService**, que ir√° nos auxiliar na intera√ß√£o com o Banco de dados. Esta Interface cont√©m diversos M√©todos, que ser√£o implementados na Classe PostagemService, com o objetivo de gerar as consultas, que ser√£o utilizadas para manipular os dados da entidade Postagem. Os M√©todos pr√©-implementados realizar√£o a√ß√µes como: Salvar (persistir), Deletar, Consultar e Atualizar dados dos objetos persistidos. 

O Diagrama de Classes da nossa Interface ser√° igual a imagem abaixo:

```mermaid
classDiagram
class IPostagemService{
<< Interface >>
+ GetAll()
+ GetById(long id)
+ GetByTitulo(string titulo)
+ Create(Postagem postagem)
+ Update(Postagem postagem)
+ Delete(Postagem postagem)
}
```

<br />

<h2>üë£ Passo 01 - Criar a Interface IPostagemService</h2>



Dentro do projeto **blogpessoal**, vamos criar a pasta **Service**:

1. No lado direito superior, na Guia **Gerenciador de Solu√ß√µes**, clique com o bot√£o direito do mouse sobre o projeto  **blogpessoal** e clique na op√ß√£o **Adicionar ü°™ Nova Pasta**

2. Digite o nome da pasta (**Service**), com a primeira letra mai√∫scula, seguindo o padr√£o do C# e pressione **enter** para concluir. O Gerenciador de Solu√ß√µes da aplica√ß√£o ficar√° semelhante a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/j7QDbmL.png" title="source: imgur.com" /></div>

<br />

Vamos criar a **Interface IPostagemService** na pasta **Service**.

1. Clique com o bot√£o direito do mouse sobre a **pasta Service** e na sequ√™ncia, clique na op√ß√£o **Adicionar ü°™ Novo item**
2. Na janela **Adicionar Novo Item**, Selecione a op√ß√£o **Interface**, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/9dkGfqs.png" title="source: imgur.com" /></div>

3. No item **Nome**, digite o nome da Interface (**IPostagemService**), como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/DUUZH2b.png" title="source: imgur.com" /></div>

4. Clique no bot√£o **Adicionar** para concluir.
5. O **Gerenciador de Solu√ß√µes** da aplica√ß√£o ficar√° semelhante a imagem abaixo:

 <div align="center"><img src="https://i.imgur.com/i3HBUWj.png" title="source: imgur.com" /></div>

<br />

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="100px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao criar a Interface Service. Na Linguagem C# toda a Interface inicia o nome com a Letra I (mai√∫scula), porque geralmente a Classe que implementa a Interface tem o mesmo nome da Interface.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

Vamos implementar e analisar o c√≥digo da **Interface IPostagemService**:

 <div align="left"><img src="https://i.imgur.com/vShuxJc.png" title="source: imgur.com" /></div>

<br />

> Antes de continuar, vamos relembrar **o que √© uma Interface?**
>
> Uma **interface** √© uma **Classe Abstrata** (uma Classe que serve de modelo para outras Classes), composta somente por M√©todos abstratos. E como tal, obviamente n√£o pode ser instanciada, ou seja, ela s√≥ cont√©m as declara√ß√µes dos M√©todos e constantes, nenhuma implementa√ß√£o, apenas as assinaturas dos M√©todos, que ser√£o implementados em uma Classe.

**Linha 01:** Importamos o Namespace **Model** (pasta Model do projeto Blog Pessoal), atrav√©s da palavra reservada **using**.

**Linhas 07 a 17:** Criamos as assinaturas dos 6 M√©todos do CRUD, que ser√£o implementados na Classe **PostagemService**. Observe que todos os M√©todos foram assinados com a Classe **Task<TResult>**. Esta Classe representa uma √∫nica opera√ß√£o que retorna um valor, executada de forma ass√≠ncrona, ou seja, o M√©todo ser√° executado em paralelo ao fluxo de execu√ß√£o principal da aplica√ß√£o. 

Como vimos nas sess√µes sobre Banco de dados, para trabalhar com os Bancos de dados, √© necess√°rio criar uma grande quantidade de c√≥digo contendo instru√ß√µes **SQL**. Atrav√©s do **Entity Framework**, estes c√≥digos SQL podem ser facilmente reduzidos, atrav√©s do **LinQ** - *Language Integrated Query*, ou *Consulta Integrada √† Linguagem*. 

O **LinQ** tem como objetivo justamente remover essa complexidade, pois ele  abstrai a complexidade envolvida na utiliza√ß√£o da linguagem SQL, permitindo consultar uma base de dados relacional, atrav√©s de uma √∫nica API, invocada atrav√©s de uma linguagem integrante do .NET Framework, como o C#.

Na pr√°tica, quando implementarmos os M√©todos assinados na Interface **IPostagemService**, utilizaremos o LinQ para gerar as consultas e criarmos as 4 opera√ß√µes do CRUD, sem escrever uma linha de SQL.

<br />

<div align="left"><img src="https://i.imgur.com/wHTDfQ2.png" title="source: imgur.com" width="4%"/> <a href="https://learn.microsoft.com/pt-br/dotnet/api/system.threading.tasks.task-1?view=net-7.0" target="_blank"><b>Documenta√ß√£o: Task</b></a></div>

<br />

<h2>üë£ Passo 02 - Criar a Classe PostagemService</h2>



Dentro da pasta **Service**, vamos criar a pasta **Implements**:

1. No lado direito superior, na Guia **Gerenciador de Solu√ß√µes**, clique com o bot√£o direito do mouse sobre a pasta **Service** e clique na op√ß√£o **Adicionar ü°™ Nova Pasta**

2. Digite o nome da pasta (**Implements**), com a primeira letra mai√∫scula, seguindo o padr√£o do C# e pressione **enter** para concluir. O Gerenciador de Solu√ß√µes da aplica√ß√£o ficar√° semelhante a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/1EQHAwj.png" title="source: imgur.com" /></div>

<br />

Vamos criar a **Classe PostagemService** na pasta **Implements**, dentro da pasta **Service**:

1. Clique com o bot√£o direito do mouse sobre a **pasta Implements** e na sequ√™ncia, clique na op√ß√£o **Adicionar ü°™ Classe**.
2. No item **Nome**, digite o nome da Classe (**PostagemService**), como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/ruEoYS7.png" title="source: imgur.com" /></div>

4. Clique no bot√£o **Adicionar** para concluir.
5. O **Gerenciador de Solu√ß√µes** da aplica√ß√£o ficar√° semelhante a imagem abaixo:

 <div align="center"><img src="https://i.imgur.com/GSby9x9.png" title="source: imgur.com" /></div>

Vamos implementar o c√≥digo da Classe **PostagemService** aos poucos, M√©todo a M√©todo. Ap√≥s a implementa√ß√£o de cada M√©todo, faremos a chamada de cada um deles na Classe **PostagemController**, para utilizar os M√©todos e acessarmos atrav√©s de Requisi√ß√µes HTTP.

Vamos come√ßar implementando a Interface **IPostagemService** na Classe **PostagemService**, atrav√©s do c√≥digo abaixo:

 <div align="left"><img src="https://i.imgur.com/Mw20qdO.png" title="source: imgur.com" /></div>

**Linha 03:** Observe que na assinatura da Classe **PostagemService**, vamos adicionar **:** (dois pontos) e na sequ√™ncia o nome da Interface que ser√° implementada (**IPostagemService**). Note que depois de adicionar a Interface, ser√° exibido um erro na Classe **PostagemService** (indicado pela seta verde no c√≥digo). 

A mensagem de erro, informa que a Classe PostagemService deve implementar todos os M√©todos da Interface IPostagemService, independente de utiliz√°-los ou n√£o. 

Vamos implementar todos os M√©todos da Interface IPostagemService atrav√©s da **Ferramenta A√ß√µes R√°pidas** <img src="https://i.imgur.com/SP8c0Am.png" title="source: imgur.com" width="3%"/>. 

> A Ferramenta **A√ß√µes R√°pidas** tem por objetivo principal corrigir e/ou sugerir corre√ß√µes para erros no c√≥digo que podem fazer com que o build (compilar e gerar o execut√°vel) da aplica√ß√£o falhe.

A anima√ß√£o abaixo mostra como implementar todos os M√©todos da Interface IPostagemService na Classe PostagemService:

 <div align="left"><img src="https://i.imgur.com/JNlPYjy.gif" title="source: imgur.com" /></div>

*Ao posicionar o cursor do mouse sobre o erro, o Visual Studio exibir√° uma l√¢mpada (<img src="https://i.imgur.com/SP8c0Am.png" title="source: imgur.com" width="3%"/>), sugerindo corre√ß√µes. Clique na primeira sugest√£o: **Implementar a Interface**. Observe que todos os 6 M√©todos da Interface ser√£o inseridos na Classe PostagemService, com uma implementa√ß√£o b√°sica.*

Ap√≥s a implementa√ß√£o b√°sica dos M√©todos, a Classe PostagemService dever√° estar com o seguinte c√≥digo:

```c#
using blogpessoal.Model;

namespace blogpessoal.Service.Implements
{
    public class PostagemService : IPostagemService
    {

        public Task<IEnumerable<Postagem>> GetAll()
        {
            throw new NotImplementedException();
        }

        public Task<Postagem?> GetById(long id)
        {
            throw new NotImplementedException();
        }

        public Task<IEnumerable<Postagem>> GetByTitulo(string titulo)
        {
            throw new NotImplementedException();
        }

        public Task<Postagem?> Create(Postagem postagem)
        {
            throw new NotImplementedException();
        }

        public Task<Postagem?> Update(Postagem postagem)
        {
            throw new NotImplementedException();
        }

        public Task Delete(Postagem postagem)
        {
            throw new NotImplementedException();
        }

    }
}
```

Observe que a ordem em que os M√©todos foram criados foi alterada. No c√≥digo acima, os M√©todos foram organizados na mesma ordem que ser√£o implementados.

Nos pr√≥ximos conte√∫dos, vamos implementar o c√≥digo das Classes PostagemService e PostagemController simultaneamente, m√©todo a m√©todo. desta forma, ao final de cada implementa√ß√£o, j√° poderemos testar a API atrav√©s de **Requisi√ß√µes HTTP**.

<br />

<h2>üë£ Passo 03 - Registrar a Classe PostagemService na Classe Program</h2>



Para finalizar, vamos registrar a Classe **PostagemService** como um servi√ßo na Classe **Program**. 

1. Abra a Classe **Program**;
2. Adicione no inicio da Classe **Program** as importa√ß√µes do Namespace **Service** (pasta Service do projeto Blog Pessoal) e do Namespace **Service.Implements** (pasta Service/Implements do projeto Blog Pessoal), atrav√©s da palavra reservada **using**, como mostra a imagem abaixo:

 <div align="left"><img src="https://i.imgur.com/882ITG4.png" title="source: imgur.com" /></div>

3. Localize a linha indicada abaixo:

 <div align="left"><img src="https://i.imgur.com/x5D5zsl.png" title="source: imgur.com" /></div>

4. Ap√≥s a linha indicada acima, adicione o trecho de c√≥digo abaixo:

```c#
		    // Registrar as Classes e Interfaces Service
            builder.Services.AddScoped<IPostagemService, PostagemService>();
```

5. Vamos entender o trecho de c√≥digo acima:

 <div align="left"><img src="https://i.imgur.com/HUXzzXx.png" title="source: imgur.com" /></div>

**Linha 35:** Atrav√©s do M√©todo **AddScoped**, vamos Registrar a Classe **PostagemService**, que implementa a Interface **IPostagemService**, que ser√° utilizada para gerar uma Collection do tipo **IServiceCollection**, que armazenar√° uma inst√¢ncia da Classe **PostagemService**, contendo todos os M√©todos implementados. A partir do registro da Classe **PostagemService** como um servi√ßo, podemos criar **Inje√ß√µes de Depend√™ncias** dentro das nossas Classes Controladoras e outras Classes de Servi√ßo, assim como fizemos com a Classe **PostagemValidator**. Desta forma, poderemos utilizar os M√©todos implementados na Classe **PostagemService**.

> **Qual √© a diferen√ßa entre AddScoped e AddTransient?**
>
> Ambas s√£o utilizadas para registrar servi√ßos dentro da aplica√ß√£o ASP.NET, mas a grande diferen√ßa est√° no tempo de vida da nova inst√¢ncia do Objeto, que ser√° criada pelos servi√ßos registrados, quando forem injetados em uma Classe.
>
> **AddTransient** por exemplo, voc√™ **sempre ter√° uma nova inst√¢ncia** do objeto, ou seja, **TODA VEZ** que o controlador for instanciado, ser√° gerada uma nova inst√¢ncia do Objeto. Este cen√°rio √© ideal para quando queremos executar a√ß√µes pontuais e j√° dispor o objeto, que normalmente √© a maioria dos casos. Por isso este modelo foi utilizado para registrar a Classe **PostagemValidator**, pois uma vez que o Objeto da Classe Postagem for validado, n√£o vamos mais precisar do Objeto PostagemValidator.
>
> O **AddScoped** trabalha de forma parecida com o **AddTransient** por√©m ele ret√©m o objeto durante toda a requisi√ß√£o, e sempre que invocado, retorna o mesmo objeto, ou seja, **UMA VEZ** que o controlador for instanciado, a inst√¢ncia do Objeto ser√° mantida em mem√≥ria, at√© que a requisi√ß√£o seja finalizada. Este cen√°rio √© ideal para quando queremos manter o objeto durante toda uma opera√ß√£o. Por isso este modelo foi utilizado para registrar a Classe **PostagemService**, pois at√© que a Requisi√ß√£o HTTP seja respondida, precisamos manter o Objeto da Classe PostagemService na mem√≥ria, para executarmos as consultas no Banco de dados. 

<br />

<div align="left"><img src="https://i.imgur.com/wHTDfQ2.png" title="source: imgur.com" width="4%"/> <a href="https://learn.microsoft.com/pt-br/dotnet/api/microsoft.extensions.dependencyinjection.servicecollectionserviceextensions.addscoped?view=dotnet-plat-ext-7.0" target="_blank"><b>Documenta√ß√£o: AddScoped</b></a></div>

<div align="left"><img src="https://i.imgur.com/wHTDfQ2.png" title="source: imgur.com" width="4%"/> <a href="https://learn.microsoft.com/pt-br/dotnet/api/microsoft.extensions.dependencyinjection.iservicecollection?view=dotnet-plat-ext-7.0" target="_blank"><b>Documenta√ß√£o: Interface IServiceCollection</b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="5%"/> <a href="" target="_blank"><b>C√≥digo fonte do projeto</b></a></div>

<br /><br />
	

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>